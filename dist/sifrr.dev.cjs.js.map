{"version":3,"file":"sifrr.dev.cjs.js","sources":["../src/loaddir.js","../src/deepmerge.js","../src/getrollupconfig.js","../src/generatechangelog.js","../src/exec.js","../src/checktag.js","../src/releasetag.js","../src/gitaddcommitpush.js","../node_modules/mkdirp/index.js","../src/test/writecoverage.js","../src/test/loadbrowser.js","../src/test/parallel.js","../src/test/testglobals.js","../src/test/transformcoverage.js","../src/test/getports.js","../src/test/server.js","../src/test/run.js","../src/objectselect.js","../src/sifrr.dev.js"],"sourcesContent":["const fs = require('fs'),\n  path = require('path');\n\nfunction loadDir({ dir, onFile = () => {}, onDir = () => {}, deep = 100 } = {}) {\n  if (!fs.existsSync(dir) || !fs.statSync(dir).isDirectory()) return false;\n  fs.readdirSync(dir).forEach(file => {\n    const filePath = path.join(dir, file);\n    fs.statSync(filePath).isDirectory() ? onDir(filePath) : onFile(filePath);\n    if (deep > 0) loadDir({ dir: filePath, onFile, onDir, deep: deep - 1 });\n  });\n  return true;\n}\n\nmodule.exports = loadDir;\n","function type(value) {\n  if (value === null) return 'null';\n  if (typeof value === 'object') {\n    if (Array.isArray(value)) return 'array';\n  }\n  return typeof value;\n}\n\nfunction deepMerge(target, merger, mergeArray = false) {\n  switch (type(target)) {\n    case 'array':\n      return mergeArray ? [...target, ...merger] : [...merger];\n    case 'object':\n      Object.keys(merger).forEach(k => {\n        target[k] = deepMerge(target[k], merger[k], mergeArray);\n      });\n      return target;\n    default:\n      return typeof merger === 'undefined' ? target : merger;\n  }\n}\n\nmodule.exports = deepMerge;\n","const path = require('path');\nconst fs = require('fs');\nconst babel = require('rollup-plugin-babel');\nconst terser = require('rollup-plugin-terser').terser;\nconst resolve = require('rollup-plugin-node-resolve');\nconst commonjs = require('rollup-plugin-commonjs');\nconst cleanup = require('rollup-plugin-cleanup');\nconst postcss = require('rollup-plugin-postcss');\nconst html = require('rollup-plugin-html');\nconst typescript = require('rollup-plugin-typescript2');\nconst replace = require('rollup-plugin-replace');\n\nconst deepMerge = require('./deepmerge');\n\nfunction moduleConfig(\n  {\n    name,\n    inputFile,\n    outputFolder,\n    minify = false,\n    type = 'cjs',\n    outputFileName,\n    replaceEnv = true\n  },\n  extraConfig = {}\n) {\n  const filename = path\n    .basename(inputFile)\n    .slice(0, path.basename(inputFile).lastIndexOf('.'))\n    .toLowerCase();\n  type = Array.isArray(type) ? type : [type];\n  const output = type.map(t => {\n    const format = t === 'cjs' ? 'cjs' : t === 'browser' ? 'iife' : 'es';\n    return {\n      file: path.join(\n        outputFolder,\n        `./${outputFileName || filename}${\n          format === 'es' ? '.module' : format === 'cjs' ? '.cjs' : ''\n        }${minify ? '.min' : ''}.js`\n      ),\n      format,\n      name,\n      sourcemap: !minify,\n      preferConst: true,\n      ...extraConfig.output\n    };\n  });\n  const ret = {\n    input: inputFile,\n    output: output.length === 1 ? output[0] : output,\n    external: Object.keys(require(path.resolve('./package.json')).dependencies || []).concat(),\n    plugins: [\n      resolve({\n        browser: type === 'browser',\n        mainFields: ['module', 'main']\n      }),\n      replaceEnv\n        ? replace({\n            ENVIRONMENT: JSON.stringify(process.env.NODE_ENV || process.env.ENV || 'development'),\n            'global.IS_NODE': JSON.stringify(type[0] === 'cjs'),\n            'global.IS_MODULE': JSON.stringify(type[0] === 'module'),\n            'global.IS_BROWSER': JSON.stringify(type[0] === 'browser')\n          })\n        : false,\n      fs.existsSync(path.resolve('tsconfig.json'))\n        ? typescript({\n            typescript: require('typescript'),\n            declarationDir: 'dist/type',\n            cacheRoot: './.ts_cache'\n          })\n        : false,\n      commonjs(),\n      postcss({\n        extensions: ['.css', '.scss', '.sass', '.less'],\n        inject: false,\n        plugins: [\n          minify\n            ? require('cssnano')({\n                preset: ['default']\n              })\n            : false,\n          require('autoprefixer')\n        ].filter(k => k)\n      }),\n      html({\n        htmlMinifierOptions: minify\n          ? {\n              collapseWhitespace: true,\n              collapseBooleanAttributes: true,\n              conservativeCollapse: true,\n              minifyJS: true\n            }\n          : {}\n      }),\n      cleanup(),\n      babel({\n        exclude: 'node_modules/**',\n        rootMode: 'upward'\n      }),\n      minify\n        ? terser({\n            output: {\n              comments: 'all'\n            }\n          })\n        : false\n    ].filter(p => p)\n  };\n\n  delete extraConfig.output;\n  return deepMerge(ret, extraConfig, true);\n}\n\nmodule.exports = moduleConfig;\n","const fs = require('fs');\nconst path = require('path');\nconst conventionalChangelog = require('conventional-changelog');\nconst rtag = /tag:\\s*[v=]?(.+?)[,)]/gi;\n\nmodule.exports = ({\n  folder = path.resolve('./'),\n  releaseCount = 0,\n  changelogFile = path.join(folder, './CHANGELOG.md'),\n  outputUnreleased = false,\n  multiRepo = false\n} = {}) => {\n  let oldChangelog = '';\n  let first = false;\n  let packageVersion = require(path.join(folder, './package.json')).version;\n  const transform = function(cm, cb) {\n    if (outputUnreleased && !first) {\n      cm.version = packageVersion;\n      first = true;\n    }\n    let match = rtag.exec(cm.gitTags);\n    rtag.lastIndex = 0;\n    if (match) cm.version = match[1];\n    cb(null, cm);\n  };\n  const options = {\n    pkg: {\n      path: path.join(folder, './package.json')\n    },\n    preset: 'angular',\n    releaseCount,\n    outputUnreleased,\n    gitRawCommitsOpts: {\n      path: folder\n    },\n    transform\n  };\n\n  if (fs.existsSync(changelogFile)) {\n    if (releaseCount === 0) fs.writeFileSync(changelogFile, '');\n    oldChangelog = fs.readFileSync(changelogFile, 'utf-8');\n  }\n  if (multiRepo) {\n    options.transform = (cm, cb) => {\n      if (cm.scope && cm.scope === multiRepo) cm.scope = null;\n      else cm.type = 'chore';\n      transform(cm, cb);\n    };\n  }\n  return new Promise((res, rej) => {\n    conventionalChangelog(options)\n      .pipe(fs.createWriteStream(changelogFile))\n      .on('error', rej)\n      .on('finish', () => {\n        fs.appendFileSync(changelogFile, oldChangelog);\n        res(changelogFile);\n      });\n  });\n};\n","const spawn = require('child_process').spawn;\nconst execa = require('child_process').exec;\n\nconst splitRegex = /((?:[\"'][^\"]+[\"'])|(?:[^ ]+))/;\n\nfunction exec(command, options = {}) {\n  if (command.indexOf('sh ') === 0 || options.spawn) {\n    process.stdout.write(`Running command: ${command} with spawn \\n`);\n    options.stdio = options.stdio || 'inherit';\n    return new Promise((res, rej) => {\n      const [c, ...args] = command.split(splitRegex).filter(x => x.trim() !== '');\n      const runner = spawn(c, args, options);\n      runner.on('close', code => {\n        if (code !== 0) {\n          process.stdout.write(`Command exited with code ${code}: ${command} \\n`);\n          rej(code);\n        } else {\n          process.stdout.write(`Finished command: ${command} \\n`);\n          res();\n        }\n      });\n    });\n  } else {\n    process.stdout.write(`Running command: ${command} \\n`);\n    return new Promise((res, rej) => {\n      execa(command, options, (err, stdout, stderr) => {\n        if (stdout) process.stdout.write(`out: ${stdout} \\n`);\n        if (stderr) process.stderr.write(`err: ${stderr} \\n`);\n        if (err !== null) {\n          process.stderr.write(`exec error: ${err}`);\n          rej(err);\n        }\n        res({ stdout, stderr });\n        process.stdout.write(`Finished command: ${command} \\n`);\n      });\n    });\n  }\n}\n\nmodule.exports = exec;\n","const exec = require('./exec');\nconst path = require('path');\n\nasync function checkTag(version, prefix = 'v') {\n  version = version || require(path.resolve('./package.json')).version;\n  const tag = prefix + version;\n  await exec('git pull');\n  return exec(`git rev-parse ${tag}`)\n    .then(() => {\n      process.stdout.write(`Tag ${tag} already exists.\\n`);\n      return true;\n    })\n    .catch(() => {\n      return false;\n    });\n}\n\nmodule.exports = checkTag;\n","const exec = require('./exec');\nconst path = require('path');\nconst checkTag = require('./checktag');\n\nasync function releaseTag(version, prefix = 'v') {\n  version = version || require(path.resolve('./package.json')).version;\n  const tag = prefix + version;\n  const exists = await checkTag(version, prefix);\n  if (!exists) {\n    await exec(`git tag -a ${tag} -m \"Release of ${tag}\"`);\n    process.stdout.write('\\n');\n    await exec(`git push origin ${tag}`);\n    return true;\n  } else {\n    return false;\n  }\n}\n\nmodule.exports = releaseTag;\n","const exec = require('./exec');\n\nmodule.exports = async function({\n  preCommand = false,\n  files = '*',\n  commitMsg = 'chore: add new files',\n  push = true\n} = {}) {\n  if (preCommand) {\n    if (Array.isArray(preCommand)) {\n      for (let i = 0; i < preCommand.length; i++) {\n        await exec(preCommand[i]);\n      }\n    } else {\n      await exec(preCommand);\n    }\n  }\n  if (Array.isArray(files)) {\n    for (let i = 0; i < files.length; i++) {\n      await exec(`git ls-files '${files[i]}' | xargs git add`);\n    }\n  } else {\n    await exec(`git ls-files '${files}' | xargs git add`);\n  }\n  await exec(`git commit -m \"${commitMsg}\"`)\n    .then(() => {\n      if (push) exec(`git push`);\n    })\n    .catch(() => {\n      process.stdout.write('Nothing to commit, not running git push. \\n');\n    });\n};\n","var path = require('path');\nvar fs = require('fs');\nvar _0777 = parseInt('0777', 8);\n\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\n\nfunction mkdirP (p, opts, f, made) {\n    if (typeof opts === 'function') {\n        f = opts;\n        opts = {};\n    }\n    else if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777 & (~process.umask());\n    }\n    if (!made) made = null;\n    \n    var cb = f || function () {};\n    p = path.resolve(p);\n    \n    xfs.mkdir(p, mode, function (er) {\n        if (!er) {\n            made = made || p;\n            return cb(null, made);\n        }\n        switch (er.code) {\n            case 'ENOENT':\n                mkdirP(path.dirname(p), opts, function (er, made) {\n                    if (er) cb(er, made);\n                    else mkdirP(p, opts, cb, made);\n                });\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                xfs.stat(p, function (er2, stat) {\n                    // if the stat fails, then that's super weird.\n                    // let the original error be the failure reason.\n                    if (er2 || !stat.isDirectory()) cb(er, made)\n                    else cb(null, made);\n                });\n                break;\n        }\n    });\n}\n\nmkdirP.sync = function sync (p, opts, made) {\n    if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777 & (~process.umask());\n    }\n    if (!made) made = null;\n\n    p = path.resolve(p);\n\n    try {\n        xfs.mkdirSync(p, mode);\n        made = made || p;\n    }\n    catch (err0) {\n        switch (err0.code) {\n            case 'ENOENT' :\n                made = sync(path.dirname(p), opts, made);\n                sync(p, opts, made);\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                var stat;\n                try {\n                    stat = xfs.statSync(p);\n                }\n                catch (err1) {\n                    throw err0;\n                }\n                if (!stat.isDirectory()) throw err0;\n                break;\n        }\n    }\n\n    return made;\n};\n","const mkdirp = require('mkdirp');\nconst path = require('path');\nconst fs = require('fs');\nconst crypto = require('crypto');\n\nfunction hash() {\n  return crypto.randomBytes(10).toString('hex');\n}\n\nmodule.exports = function writeCoverage(coverage, folder, prefix = '') {\n  const file = path.join(folder, `${Date.now()}-${prefix}-${hash()}.json`);\n  mkdirp.sync(path.dirname(file), err => {\n    if (err) throw err;\n  });\n\n  const contents = JSON.stringify(coverage || {});\n  if (contents !== '{}') fs.writeFileSync(file, contents);\n};\n","/* eslint-disable require-atomic-updates */\nconst writeCoverage = require('./writecoverage');\nconst puppeteer = require('puppeteer');\n\nasync function writePageCoverage(p, nycReport) {\n  /* istanbul ignore next */\n  const jsCoverage = await p.evaluate(() => window.__coverage__);\n  writeCoverage(jsCoverage, nycReport, 'browser-coverage');\n}\n\nfunction setPageForCoverage(p, nycReport) {\n  p.goto = async (url, options) => {\n    await writePageCoverage(p, nycReport);\n    return p.mainFrame().goto(url, options);\n  };\n\n  p._close = p.close;\n  p.close = async () => {\n    await writePageCoverage(p, nycReport);\n    return p._close();\n  };\n}\n\nmodule.exports = async function(coverage, nycReport, browserWSEndpoint) {\n  let browser;\n  if (!global.browser) {\n    if (typeof browserWSEndpoint === 'string') {\n      browser = global.browser = await puppeteer.connect({\n        browserWSEndpoint,\n        ignoreHTTPSErrors: true\n      });\n    } else {\n      browser = global.browser = await puppeteer.launch({\n        // to make it work in ci\n        args: ['--no-sandbox', '--disable-setuid-sandbox'],\n        ignoreHTTPSErrors: true,\n        headless: process.env.HEADLESS !== 'false',\n        devtools: false\n      });\n    }\n\n    if (coverage && nycReport) {\n      browser.__newPage = browser.newPage;\n      browser.newPage = async () => {\n        const p = await browser.__newPage();\n        setPageForCoverage(p, nycReport);\n        return p;\n      };\n\n      browser.__close = browser.close;\n      browser.close = async () => {\n        const pages = await browser.pages();\n        for (let i = 0; i < pages.length; i++) {\n          await pages[i].close();\n        }\n        return browser.__close();\n      };\n    }\n  } else {\n    browser = global.browser;\n  }\n  const page = await browser.newPage();\n  await page.setViewport({ width: 1280, height: 800 });\n\n  if (!global.page) global.page = page;\n\n  return {\n    browser,\n    page\n  };\n};\n","const path = require('path');\nconst { fork } = require('child_process');\nconst JsonFn = require('json-fn');\nconst loadBrowser = require('./loadbrowser');\n\nmodule.exports = async function(options, shareBrowser = true) {\n  const promises = [];\n  let failures = 0;\n  if (shareBrowser) await loadBrowser();\n\n  for (let i = 0; i < options.length; i++) {\n    const opts = options[i];\n    opts.browserWSEndpoint = shareBrowser ? global.browser.wsEndpoint() : opts.browserWSEndpoint;\n\n    const childRun = fork(path.join(__dirname, './run'), process.argv);\n    promises.push(\n      new Promise(res => {\n        childRun.on('exit', code => {\n          if (code && code > 0)\n            global.console.log(\n              '\\x1b[36m%s\\x1b[0m',\n              `Config#${i}: tests from ${opts.root} exited with code ${code}`\n            );\n          res();\n        });\n\n        childRun.on('message', e => {\n          failures += Number(e);\n        });\n\n        childRun.on('error', e => {\n          global.console.error(e);\n        });\n\n        childRun.send(JsonFn.stringify(opts));\n      })\n    );\n  }\n\n  await Promise.all(promises);\n  if (shareBrowser) await global.browser.close();\n\n  if (failures > 0) {\n    throw failures;\n  } else {\n    return 0;\n  }\n};\n","const path = require('path');\nconst deepMerge = require('../deepmerge');\n\nfunction getCaller() {\n  try {\n    let err = new Error();\n    let callerfile;\n    let currentfile;\n\n    Error.prepareStackTrace = function(err, stack) {\n      return stack;\n    };\n\n    currentfile = err.stack.shift().getFileName();\n\n    while (err.stack.length) {\n      callerfile = err.stack.shift().getFileName();\n\n      if (currentfile !== callerfile) return callerfile;\n    }\n  } catch (err) {\n    // do nothing\n  }\n  return undefined;\n}\n\nmodule.exports = (testOptions, parallel) => {\n  global.__pdescribes = [];\n  global.ENV = process.env.NODE_ENV = process.env.NODE_ENV || 'test';\n  global.Mocha = require('mocha');\n  global.chai = require('chai');\n  global.sinon = global.sinon || require('sinon').createSandbox();\n  global.assert = chai.assert;\n  global.expect = chai.expect;\n  global.should = chai.should();\n  global.delay = time => {\n    return new Promise(res => {\n      setTimeout(function() {\n        res();\n      }, time);\n    });\n  };\n  global.pdescribe = function(name, fxn) {\n    const testFile = getCaller();\n    if (testFile && testOptions && !testOptions.parallel && parallel) {\n      const newOpts = deepMerge({}, testOptions);\n      deepMerge(newOpts, {\n        browserWSEndpoint: global.browser ? global.browser.wsEndpoint() : undefined,\n        filters: [testFile],\n        parallel: true,\n        junitXmlFile: path.join(\n          testOptions.junitXmlFile,\n          `../../${path.basename(getCaller()).replace('.test.js', '')}/results.xml`\n        ),\n        port: 'random'\n      });\n      global.__pdescribes.push(require('./parallel')([newOpts], true).catch(e => e));\n    } else {\n      describe(name, fxn);\n    }\n  };\n\n  chai.use(require('chai-as-promised'));\n};\n","const fs = require('fs');\n\nconst cov = require('istanbul-lib-coverage'),\n  srcmap = require('istanbul-lib-source-maps'),\n  { createInstrumenter } = require('istanbul-lib-instrument'),\n  loadDir = require('../loaddir'),\n  reporter = require('istanbul-api').createReporter();\n\nconst instrumenter = createInstrumenter({\n  esModules: true\n});\n\nmodule.exports = function(nycReport, srcFolder, srcFileRegex, reporters = ['html']) {\n  const sm = srcmap.createSourceMapStore({});\n  let map = cov.createCoverageMap();\n  if (fs.existsSync(nycReport)) {\n    // Browser tests\n    loadDir({\n      dir: nycReport,\n      onFile: file => {\n        if (file.match(/browser/)) map.merge(JSON.parse(fs.readFileSync(file)));\n      }\n    });\n\n    map = sm.transformCoverage(map).map;\n\n    // unit tests\n    loadDir({\n      dir: nycReport,\n      onFile: file => {\n        if (file.match(/unit/)) map.merge(JSON.parse(fs.readFileSync(file)));\n      }\n    });\n\n    // Add Other files without coverage\n    loadDir({\n      dir: srcFolder,\n      onFile: file => {\n        if (file.slice(-3) === '.js' && file.match(srcFileRegex) && !map.data[file]) {\n          const content = fs.readFileSync(file).toString();\n          instrumenter.instrumentSync(content, file);\n          const emptyCov = {};\n          emptyCov[file] = instrumenter.fileCoverage;\n          map.merge(emptyCov);\n        }\n      }\n    });\n\n    // Remove files that we don't need coverage of\n    map.filter(file => file.match(srcFileRegex));\n\n    reporters.forEach(r => reporter.add(r));\n    reporter.write(map);\n  }\n};\n","const portfinder = require('portfinder');\n\nmodule.exports = async function() {\n  const first = await portfinder.getPortPromise({\n    port: 10000\n  });\n  const second = await portfinder.getPortPromise({\n    port: first + 1\n  });\n\n  return [first, second];\n};\n","const path = require('path');\nconst fs = require('fs');\n\nconst loadDir = require('../loaddir');\nconst getPorts = require('./getports');\nconst instrumenter = require('istanbul-lib-instrument').createInstrumenter();\nconst { App, SSLApp } = require('@sifrr/server');\n\nfunction staticInstrument(app, folder, coverage = false) {\n  loadDir({\n    dir: folder,\n    onFile: filePath => {\n      if (coverage && filePath.slice(-3) === '.js' && fs.existsSync(filePath + '.map')) {\n        app.get('/' + path.relative(folder, filePath), res => {\n          res.onAborted(global.console.log);\n          const text = fs.readFileSync(filePath, 'utf-8');\n          res.writeHeader('content-type', 'application/javascript; charset=UTF-8');\n          res.end(\n            instrumenter.instrumentSync(\n              text,\n              filePath,\n              JSON.parse(fs.readFileSync(filePath + '.map'))\n            )\n          );\n        });\n      } else {\n        app.file('/' + path.relative(folder, filePath), filePath);\n      }\n    }\n  });\n}\n\nmodule.exports = async function(\n  root,\n  {\n    extraStaticFolders = [],\n    setGlobals = true,\n    coverage = true,\n    port = false,\n    securePort = false\n  } = {}\n) {\n  const apps = [];\n  function startServer(app, hostingPort, secure) {\n    staticInstrument(app, root, coverage);\n    staticInstrument(app, path.join(root, '../../dist'), coverage);\n    extraStaticFolders.forEach(folder => {\n      staticInstrument(app, folder, coverage);\n    });\n\n    apps.push([app, hostingPort, secure]);\n  }\n\n  let normalApp, secureApp;\n\n  if (port) {\n    let app;\n    if (fs.existsSync(path.join(root, 'server.js'))) {\n      app = require(path.join(root, 'server.js'));\n    } else {\n      app = new App();\n    }\n    if (typeof app.file === 'function') startServer(app, port, false);\n    else apps.push([app, port, false]);\n    normalApp = app;\n  }\n\n  if (securePort) {\n    let app;\n    if (fs.existsSync(path.join(root, 'secureserver.js'))) {\n      app = require(path.join(root, 'secureserver.js'));\n    } else {\n      app = new SSLApp({\n        key_file_name: path.join(__dirname, 'keys/server.key'),\n        cert_file_name: path.join(__dirname, 'keys/server.crt')\n      });\n    }\n    if (typeof app.file === 'function') startServer(app, securePort, true);\n    else apps.push([app, securePort, true]);\n    secureApp = app;\n  }\n\n  return {\n    secureApp: secureApp,\n    app: normalApp,\n    listen: async () => {\n      for (let i = 0; i < apps.length; i++) {\n        let [app, port, secure] = apps[i];\n        // eslint-disable-next-line require-atomic-updates\n        if (port === 'random') port = (await getPorts())[0];\n\n        if (setGlobals && port) {\n          global[secure ? 'SPATH' : 'PATH'] = `http${secure ? 's' : ''}://localhost:${port}`;\n          global[secure ? 'securePort' : 'port'] = port;\n        }\n\n        app.listen(port, socket => {\n          if (socket) {\n            global.console.log(`Test server listening on port ${port}, serving ${root}`);\n          } else {\n            global.console.log('Test server failed to listen to port ' + port);\n          }\n        });\n      }\n    },\n    close: () => {\n      secureApp && secureApp.close && secureApp.close();\n      normalApp && normalApp.close && normalApp.close();\n    }\n  };\n};\n","const fs = require('fs');\nconst path = require('path');\nconst Mocha = require('mocha');\nconst JsonFn = require('json-fn');\n\nconst exec = require('../exec');\nconst deepMerge = require('../deepmerge');\nconst testGlobals = require('./testglobals');\nconst loadDir = require('../loaddir');\nconst writeCoverage = require('./writecoverage');\nconst loadBrowser = require('./loadbrowser');\nconst transformCoverage = require('./transformcoverage');\n\nfunction loadTests(dir, mocha, regex, filters) {\n  loadDir({\n    dir: dir,\n    onFile: filePath => {\n      if (filters.map(bf => filePath.indexOf(bf) >= 0).indexOf(true) >= 0) {\n        if (filePath.match(regex)) mocha.addFile(filePath);\n      }\n    }\n  });\n}\n\nasync function runCommands(commands) {\n  if (!commands) return;\n  if (Array.isArray(commands)) {\n    for (let j = 0; j < commands.length; j++) {\n      await exec(commands[j]).catch(global.console.error);\n    }\n  } else {\n    await exec(commands).catch(global.console.error);\n  }\n}\n\nasync function runTests(options = {}, parallel = false, shareBrowser) {\n  if (Array.isArray(options)) {\n    for (let i = 0; i < options.length; i++) {\n      await runCommands(options[i].preCommand);\n      delete options[i].preCommand;\n    }\n    if (parallel) return require('./parallel')(options, shareBrowser);\n    else {\n      let failures = 0;\n      for (let i = 0; i < options.length; i++) {\n        failures += await runTests(options[i]).catch(f => {\n          if (Number(f)) return Number(f);\n          else process.stderr.write(f + '\\n');\n          return 0;\n        });\n      }\n      if (failures > 0) throw failures;\n      else return 0;\n    }\n  }\n\n  const {\n    root = path.resolve('./'),\n    serverOnly = false,\n    runUnitTests = true,\n    runBrowserTests = true,\n    coverage = false,\n    setGlobals = true,\n    testFileRegex = /\\.test\\.js$/,\n    sourceFileRegex = /\\.js$/,\n    filters = [''],\n    folders = {},\n    preCommand = false,\n    port = 'random',\n    securePort = false,\n    useJunitReporter = false,\n    junitXmlFile = path.join(root, `./test-results/${path.basename(root)}/results.xml`),\n    inspect = false,\n    reporters = ['html'],\n    mochaOptions = {},\n    before,\n    browserWSEndpoint\n  } = options;\n\n  if (inspect) require('inspector').open(undefined, undefined, true);\n\n  const beforeRet = typeof before === 'function' ? before() : false;\n  if (beforeRet instanceof Promise) await beforeRet;\n\n  const allFolders = deepMerge(\n    {\n      unitTest: path.join(root, './test/unit'),\n      browserTest: path.join(root, './test/browser'),\n      public: path.join(root, './test/public'),\n      static: [],\n      coverage: path.join(root, './.nyc_output'),\n      source: path.join(root, './src')\n    },\n    folders,\n    true\n  );\n\n  if (fs.existsSync(path.join(root, 'tsconfig.json'))) require('ts-node').register({});\n\n  await runCommands(preCommand);\n\n  const servers = await require('./server')(allFolders.public, {\n    extraStaticFolders: allFolders.static,\n    setGlobals,\n    coverage,\n    port,\n    securePort\n  });\n\n  if (serverOnly) {\n    await servers.listen();\n    return 'server';\n  }\n  if (setGlobals) testGlobals(options, parallel);\n\n  if (useJunitReporter) {\n    mochaOptions.reporter = 'mocha-junit-reporter';\n    mochaOptions.reporterOptions = {\n      mochaFile: junitXmlFile\n    };\n  }\n  const mocha = new Mocha(mochaOptions);\n\n  if ((runBrowserTests || !runUnitTests) && fs.existsSync(allFolders.browserTest)) {\n    await servers.listen();\n    await loadBrowser(coverage, allFolders.coverage, browserWSEndpoint);\n    loadTests(allFolders.browserTest, mocha, testFileRegex, filters);\n  }\n\n  if ((runUnitTests || !runBrowserTests) && fs.existsSync(allFolders.unitTest)) {\n    loadTests(allFolders.unitTest, mocha, testFileRegex, filters);\n  }\n\n  return new Promise((res, rej) => {\n    mocha.run(async failures => {\n      servers.close();\n\n      // close browser\n      if (global.browser && !browserWSEndpoint) {\n        await browser.close();\n        delete global.browser;\n        delete global.page;\n      }\n\n      if (global.__pdescribes) {\n        const fs = await Promise.all(global.__pdescribes);\n        failures += fs.reduce((a, b) => a + b, 0);\n      }\n\n      // Get and write code coverage\n      if (coverage) {\n        writeCoverage(global.__coverage__, allFolders.coverage, 'unit-coverage');\n        transformCoverage(allFolders.coverage, allFolders.source, sourceFileRegex, reporters);\n      }\n\n      if (failures) rej(failures);\n      else res(0);\n    });\n  });\n}\n\nprocess.on('message', async options => {\n  options = JsonFn.parse(options);\n\n  await runTests(options, true)\n    .catch(f => {\n      if (Number(f)) process.send(`${f}`);\n      else process.stderr.write(f + '\\n');\n    })\n    .then(r => {\n      if (r !== 'server') process.exit();\n    });\n});\n\nmodule.exports = runTests;\n","module.exports = (obj, keys = []) => {\n  const ret = {};\n  keys.forEach(k => {\n    if (obj[k]) ret[k] = obj[k];\n  });\n  return ret;\n};\n","module.exports = {\n  loadDir: require('./loaddir'),\n  deepMerge: require('./deepmerge'),\n  getRollupConfig: require('./getrollupconfig'),\n  generateChangelog: require('./generatechangelog'),\n  exec: require('./exec'),\n  checkTag: require('./checktag'),\n  releaseTag: require('./releasetag'),\n  gitAddCommitPush: require('./gitaddcommitpush'),\n  runTests: require('./test/run'),\n  objectSelect: require('./objectselect')\n};\n"],"names":["loadDir","dir","onFile","onDir","deep","fs","existsSync","statSync","isDirectory","readdirSync","forEach","file","filePath","path","join","type","value","Array","isArray","deepMerge","target","merger","mergeArray","Object","keys","k","terser","require$$0","moduleConfig","name","inputFile","outputFolder","minify","outputFileName","replaceEnv","extraConfig","filename","basename","slice","lastIndexOf","toLowerCase","output","map","t","format","sourcemap","preferConst","ret","input","length","external","require","resolve","dependencies","concat","plugins","browser","mainFields","replace","ENVIRONMENT","JSON","stringify","process","env","NODE_ENV","ENV","typescript","require$$1","declarationDir","cacheRoot","commonjs","postcss","extensions","inject","require$$2","preset","require$$3","filter","html","htmlMinifierOptions","collapseWhitespace","collapseBooleanAttributes","conservativeCollapse","minifyJS","cleanup","babel","exclude","rootMode","comments","p","rtag","folder","releaseCount","changelogFile","outputUnreleased","multiRepo","oldChangelog","first","packageVersion","version","transform","cm","cb","match","exec","gitTags","lastIndex","options","pkg","gitRawCommitsOpts","writeFileSync","readFileSync","scope","Promise","res","rej","conventionalChangelog","pipe","createWriteStream","on","appendFileSync","spawn","execa","splitRegex","command","indexOf","stdout","write","stdio","c","args","split","x","trim","runner","code","err","stderr","checkTag","prefix","tag","then","catch","releaseTag","exists","preCommand","files","commitMsg","push","i","hash","crypto","randomBytes","toString","writeCoverage","coverage","Date","now","mkdirp","sync","dirname","contents","writePageCoverage","nycReport","jsCoverage","evaluate","window","__coverage__","setPageForCoverage","goto","url","mainFrame","_close","close","browserWSEndpoint","global","puppeteer","connect","ignoreHTTPSErrors","launch","headless","HEADLESS","devtools","__newPage","newPage","__close","pages","page","setViewport","width","height","fork","shareBrowser","promises","failures","loadBrowser","opts","wsEndpoint","childRun","__dirname","argv","console","log","root","e","Number","error","send","JsonFn","all","getCaller","Error","callerfile","currentfile","prepareStackTrace","stack","shift","getFileName","undefined","testOptions","parallel","__pdescribes","Mocha","chai","sinon","createSandbox","assert","expect","should","delay","time","setTimeout","pdescribe","fxn","testFile","newOpts","filters","junitXmlFile","port","describe","use","require$$4","createInstrumenter","reporter","createReporter","instrumenter","esModules","srcFolder","srcFileRegex","reporters","sm","srcmap","createSourceMapStore","cov","createCoverageMap","merge","parse","transformCoverage","data","content","instrumentSync","emptyCov","fileCoverage","r","add","portfinder","getPortPromise","second","App","SSLApp","staticInstrument","app","get","relative","onAborted","text","writeHeader","end","extraStaticFolders","setGlobals","securePort","apps","startServer","hostingPort","secure","normalApp","secureApp","key_file_name","cert_file_name","listen","getPorts","socket","loadTests","mocha","regex","bf","addFile","runCommands","commands","j","runTests","f","serverOnly","runUnitTests","runBrowserTests","testFileRegex","sourceFileRegex","folders","useJunitReporter","inspect","mochaOptions","before","open","beforeRet","allFolders","unitTest","browserTest","public","static","source","register","servers","testGlobals","reporterOptions","mochaFile","run","reduce","a","b","exit","obj","getRollupConfig","generateChangelog","require$$5","require$$6","gitAddCommitPush","require$$7","require$$8","objectSelect","require$$9"],"mappings":"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"}