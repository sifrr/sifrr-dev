{"version":3,"file":"sifrr.dev.js","sources":["../src/eslintrc.js","../src/loaddir.js","../src/deepmerge.js","../src/getrollupconfig.js","../src/generatechangelog.js","../src/exec.js","../src/checktag.js","../src/releasetag.js","../src/gitaddcommitpush.js","../src/test/getports.js","../src/test/server.js","../src/test/parallel.js","../src/test/testglobals.js","../node_modules/mkdirp/index.js","../src/test/writecoverage.js","../src/test/loadbrowser.js","../src/test/transformcoverage.js","../src/test/run.js","../src/objectselect.js","../src/sifrr.dev.js"],"sourcesContent":["module.exports = {\n  env: {\n    browser: true,\n    node: true,\n    es6: true,\n    mocha: true\n  },\n  // for tests\n  globals: {\n    ENV: true,\n    chai: false,\n    sinon: false,\n    assert: false,\n    expect: false,\n    should: false,\n    delay: false,\n    port: false,\n    PATH: false,\n    SPATH: false,\n    page: false,\n    browser: false\n  },\n  extends: 'eslint:recommended',\n  parserOptions: {\n    sourceType: 'module',\n    ecmaVersion: 2017,\n    esversion: 2017\n  },\n  rules: {\n    indent: [\n      'error',\n      2\n    ],\n    'linebreak-style': [\n      'error',\n      'unix'\n    ],\n    quotes: [\n      'error',\n      'single',\n      {\n        avoidEscape: true,\n        allowTemplateLiterals: true\n      }\n    ],\n    semi: [\n      'warn',\n      'always'\n    ],\n    'quote-props': [\n      'error',\n      'as-needed'\n    ],\n    'no-var': [\n      'error'\n    ],\n    'max-lines': [\n      'error',\n      220\n    ],\n    'mocha/no-exclusive-tests': 'error'\n  },\n  plugins: [\n    'html',\n    'mocha'\n  ],\n  settings: {\n    'html/indent': '+2'\n  }\n};\n","const fs = require('fs'),\n  path = require('path');\n\nfunction loadDir({\n  dir,\n  onFile = () => {},\n  onDir = () => {},\n  deep = 100\n} = {}) {\n  if (!fs.existsSync(dir) || !fs.statSync(dir).isDirectory()) return false;\n  fs.readdirSync(dir).forEach(file => {\n    const filePath = path.join(dir, file);\n    fs.statSync(filePath).isDirectory() ? onDir(filePath) : onFile(filePath);\n    if (deep > 0) loadDir({ dir: filePath, onFile, onDir, deep: deep - 1});\n  });\n  return true;\n}\n\nmodule.exports = loadDir;\n","function type(value) {\n  if (value === null) return 'null';\n  if (typeof value === 'object') {\n    if (Array.isArray(value)) return 'array';\n  }\n  return typeof value;\n}\n\nfunction deepMerge(target, merger, mergeArray = false) {\n  switch (type(target)) {\n  case 'array':\n    return mergeArray ? [...target, ...merger] : [...merger];\n  case 'object':\n    Object.keys(merger).forEach(k => {\n      target[k] = deepMerge(target[k], merger[k], mergeArray);\n    });\n    return target;\n  default:\n    return typeof merger === 'undefined' ? target : merger;\n  }\n}\n\nmodule.exports = deepMerge;\n","const path = require('path');\nconst babel = require('rollup-plugin-babel');\nconst terser = require('rollup-plugin-terser').terser;\nconst resolve = require('rollup-plugin-node-resolve');\nconst commonjs = require('rollup-plugin-commonjs');\nconst cleanup = require('rollup-plugin-cleanup');\nconst postcss = require('rollup-plugin-postcss');\nconst html = require('rollup-plugin-html');\n\nconst deepMerge = require('./deepmerge');\n\nfunction moduleConfig({\n  name,\n  inputFile,\n  outputFolder,\n  minify = false,\n  type = 'cjs',\n  outputFileName\n}, extraConfig) {\n  const filename = path.basename(inputFile).slice(0, path.basename(inputFile).lastIndexOf('.')).toLowerCase();\n  const format = type === 'cjs' ? 'cjs' : (type === 'browser' ? 'umd' : 'es');\n  const ret = {\n    input: inputFile,\n    output: {\n      file: path.join(outputFolder, `./${(outputFileName || filename) + (type === 'module' ? '.module' : '') + (minify ? '.min' : '')}.js`),\n      format,\n      name,\n      sourcemap: !minify,\n      preferConst: true,\n    },\n    plugins: [\n      resolve({\n        browser: type === 'browser',\n        mainFields: ['module', 'main']\n      }),\n      commonjs(),\n      postcss({\n        extensions: ['.css', '.scss', '.sass', '.less'],\n        inject: false,\n        plugins: [\n          minify ? require('cssnano')({\n            preset: [ 'default' ],\n          }) : false,\n          require('autoprefixer')\n        ].filter(k => k)\n      }),\n      html({\n        htmlMinifierOptions: minify ? {\n          collapseWhitespace: true,\n          collapseBooleanAttributes: true,\n          conservativeCollapse: true,\n          minifyJS: true\n        } : {}\n      })\n    ]\n  };\n\n  if (type !== 'module') {\n    ret.plugins.push(babel({\n      exclude: 'node_modules/**',\n      rootMode: 'upward'\n    }));\n  }\n\n  ret.plugins.push(cleanup());\n\n  if (minify) {\n    ret.plugins.push(terser({\n      output: {\n        comments: 'all'\n      }\n    }));\n  }\n\n  return deepMerge(ret, extraConfig, true);\n}\n\nmodule.exports = moduleConfig;\n","const fs = require('fs');\nconst path = require('path');\nconst conventionalChangelog = require('conventional-changelog');\nconst rtag = /tag:\\s*[v=]?(.+?)[,)]/gi;\n\nmodule.exports = ({\n  folder = path.resolve('./'),\n  releaseCount = 0,\n  changelogFile = path.join(folder, './CHANGELOG.md'),\n  outputUnreleased = false,\n  multiRepo = false\n} = {}) => {\n  let oldChangelog = '';\n  let first = false;\n  let packageVersion = require(path.join(folder, './package.json')).version;\n  const transform = function(cm, cb) {\n    if (outputUnreleased && !first) {\n      cm.version = packageVersion;\n      first = true;\n    }\n    let match = rtag.exec(cm.gitTags);\n    rtag.lastIndex = 0;\n    if (match) cm.version = match[1];\n    cb(null, cm);\n  };\n  const options = {\n    pkg: {\n      path: path.join(folder, './package.json'),\n    },\n    preset: 'angular',\n    releaseCount,\n    outputUnreleased,\n    gitRawCommitsOpts: {\n      path: folder\n    },\n    transform\n  };\n\n  if (fs.existsSync(changelogFile)) {\n    if (releaseCount === 0) fs.writeFileSync(changelogFile, '');\n    oldChangelog = fs.readFileSync(changelogFile, 'utf-8');\n  }\n  if (multiRepo) {\n    options.transform = (cm, cb) => {\n      if (cm.scope && cm.scope === multiRepo) cm.scope = null;\n      else cm.type = 'chore';\n      transform(cm, cb);\n    };\n  }\n  return new Promise((res, rej) => {\n    conventionalChangelog(options)\n      .pipe(fs.createWriteStream(changelogFile))\n      .on('error', rej)\n      .on('finish', () => {\n        fs.appendFileSync(changelogFile, oldChangelog);\n        res(changelogFile);\n      });\n  });\n};\n","const spawn = require('child_process').spawn;\nconst execa = require('child_process').exec;\n\nconst splitRegex = /((?:[\"'][^\"]+[\"'])|(?:[^ ]+))/;\n\nfunction exec(command, options = {}) {\n  if (command.indexOf('sh ') === 0 || options.spawn) {\n    process.stdout.write(`Running command: ${command} with spawn \\n`);\n    options.stdio = options.stdio || 'inherit';\n    return new Promise((res, rej) => {\n      const [c, ...args] = command.split(splitRegex).filter(x => x.trim() !== '');\n      const runner = spawn(c, args, options);\n      runner.on('close', (code) => {\n        if (code !== 0) {\n          process.stdout.write(`Command exited with code ${code}: ${command} \\n`);\n          rej(code);\n        } else {\n          process.stdout.write(`Finished command: ${command} \\n`);\n          res();\n        }\n      });\n    });\n  } else {\n    process.stdout.write(`Running command: ${command} \\n`);\n    return new Promise((res, rej) => {\n      execa(command, options, (err, stdout, stderr) => {\n        if (stdout) process.stdout.write(`out: ${stdout} \\n`);\n        if (stderr) process.stderr.write(`err: ${stderr} \\n`);\n        if (err !== null) {\n          process.stderr.write(`exec error: ${err}`);\n          rej(err);\n        }\n        res({ stdout, stderr });\n        process.stdout.write(`Finished command: ${command} \\n`);\n      });\n    });\n  }\n}\n\nmodule.exports =  exec;\n","const exec = require('./exec');\nconst path = require('path');\n\nasync function checkTag(version, prefix = 'v') {\n  version = version || require(path.resolve('./package.json')).version;\n  const tag = prefix + version;\n  await exec('git pull');\n  return exec(`git rev-parse ${tag}`).then(() => {\n    process.stdout.write(`Tag ${tag} already exists.\\n`);\n    return true;\n  }).catch(() => {\n    return false;\n  });\n}\n\nmodule.exports = checkTag;\n","const exec = require('./exec');\nconst path = require('path');\nconst checkTag = require('./checktag');\n\nasync function releaseTag(version, prefix = 'v') {\n  version = version || require(path.resolve('./package.json')).version;\n  const tag = prefix + version;\n  const exists = await checkTag(version, prefix);\n  if (!exists) {\n    await exec(`git tag -a ${tag} -m \"Release of ${tag}\"`);\n    process.stdout.write('\\n');\n    await exec(`git push origin ${tag}`);\n    return true;\n  } else {\n    return false;\n  }\n}\n\nmodule.exports = releaseTag;\n","const exec = require('./exec');\n\nmodule.exports = async function({\n  preCommand = false,\n  files = '*',\n  commitMsg = 'chore: add new files',\n  push = true\n} = {}) {\n  if (preCommand) {\n    if (Array.isArray(preCommand)) {\n      for (let i = 0; i < preCommand.length; i++) {\n        await exec(preCommand[i]);\n      }\n    } else {\n      await exec(preCommand);\n    }\n  }\n  if (Array.isArray(files)) {\n    for (let i = 0; i < files.length; i++) {\n      await exec(`git ls-files '${files[i]}' | xargs git add`);\n    }\n  } else {\n    await exec(`git ls-files '${files}' | xargs git add`);\n  }\n  await exec(`git commit -m \"${commitMsg}\"`).then(() => {\n    if (push) exec(`git push`);\n  }).catch(() => {\n    process.stdout.write('Nothing to commit, not running git push. \\n');\n  });\n};\n","const portfinder = require('portfinder');\n\nmodule.exports = async function() {\n  const first = await portfinder.getPortPromise({\n    port: 10000\n  });\n  const second = await portfinder.getPortPromise({\n    port: first + 1,\n  });\n\n  return [first, second];\n};\n","const path = require('path');\nconst fs = require('fs');\n\nconst loadDir = require('../loaddir');\nconst getPorts = require('./getports');\nconst instrumenter = require('istanbul-lib-instrument').createInstrumenter();\nconst { App, SSLApp } = require('@sifrr/server');\n\nfunction staticInstrument(app, folder, coverage = false) {\n  loadDir({\n    dir: folder,\n    onFile: (filePath) => {\n      if (coverage && filePath.slice(-3) === '.js') {\n        app.get('/' + path.relative(folder, filePath), (res) => {\n          res.onAborted(global.console.log);\n          const text = fs.readFileSync(filePath, 'utf-8');\n          if (fs.existsSync(filePath + '.map')) {\n            res.writeHeader('content-type', 'application/javascript; charset=UTF-8');\n            res.end(instrumenter.instrumentSync(text, filePath, JSON.parse(fs.readFileSync(filePath + '.map'))));\n          } else {\n            res.writeHeader('content-type', 'application/javascript; charset=UTF-8');\n            res.end(text);\n          }\n        });\n      } else {\n        app.file('/' + path.relative(folder, filePath), filePath);\n      }\n    }\n  });\n}\n\nmodule.exports = async function(root, {\n  extraStaticFolders = [],\n  setGlobals = true,\n  coverage = true,\n  port = false,\n  securePort = false\n} = {}) {\n  const listeners = [];\n  function startServer(app, hostingPort) {\n    staticInstrument(app, root, coverage);\n    staticInstrument(app, path.join(root, '../../dist'), coverage);\n    extraStaticFolders.forEach(folder => {\n      staticInstrument(app, folder, coverage);\n    });\n\n    listeners.push(app.listen.bind(app, hostingPort, (socket) => {\n      if (socket) {\n        global.console.log(`Test server listening on port ${hostingPort}, serving ${root}`);\n      } else {\n        global.console.log('Test server failed to listen to port ' + hostingPort);\n      }\n    }));\n  }\n\n  let normalApp, secureApp;\n\n  const freePorts = await getPorts();\n  if (port) {\n    if (port === 'random') port = freePorts[0];\n    let app;\n    if (fs.existsSync(path.join(root, 'server.js'))) {\n      app = require(path.join(root, 'server.js'));\n    } else {\n      app = new App();\n    }\n    if (typeof app.file === 'function') startServer(app, port);\n    else listeners.push(app.listen.bind(app, port));\n    normalApp = app;\n  }\n\n  if (setGlobals && port) {\n    global.PATH = `http://localhost:${port}`;\n    global.port = port;\n  }\n\n  if (securePort) {\n    if (securePort === 'random') securePort = freePorts[1];\n    let app;\n    if (fs.existsSync(path.join(root, 'secureserver.js'))) {\n      app = require(path.join(root, 'secureserver.js'));\n    } else {\n      app = new SSLApp({\n        key_file_name: path.join(__dirname, 'keys/server.key'),\n        cert_file_name: path.join(__dirname, 'keys/server.crt')\n      });\n    }\n    if (typeof app.file === 'function') startServer(app, securePort);\n    else listeners.push(app.listen.bind(app, securePort));\n    secureApp = app;\n  }\n\n  if (setGlobals && securePort) {\n    global.SPATH = `https://localhost:${securePort}`;\n    global.securePort = securePort;\n  }\n\n  return {\n    secureApp: secureApp,\n    app: normalApp,\n    listen: () => {\n      listeners.forEach(l => l());\n    },\n    close: () => {\n      secureApp && secureApp.close && secureApp.close();\n      normalApp && normalApp.close && normalApp.close();\n    }\n  };\n};\n","const path = require('path');\nconst { fork } = require('child_process');\nconst JsonFn = require('json-fn');\n\nmodule.exports = async function(options) {\n  const promises = [];\n  let failures = 0;\n  for (let i = 0; i < options.length; i++) {\n    const opts = options[i];\n    opts.before = opts.before ? opts.before.toString() : 'false';\n\n    const childRun = fork(path.join(__dirname, './run'), process.argv);\n    promises.push(new Promise(res => {\n      childRun.on('exit', code => {\n        if (code && code > 0) global.console.log('\\x1b[36m%s\\x1b[0m', `Config#${i}: tests from ${opts.root} exited with code ${code}`);\n        res();\n      });\n\n      childRun.on('message', (e) => {\n        failures += Number(e);\n      });\n\n      childRun.on('error', (e) => {\n        global.console.error(e);\n      });\n\n      childRun.send(JsonFn.stringify(opts));\n    }));\n  }\n\n  await Promise.all(promises);\n\n  if (failures > 0) {\n    throw failures;\n  } else {\n    return 0;\n  }\n};\n","const deepMerge = require('../deepmerge');\n\nfunction getCaller() {\n  try {\n    let err = new Error();\n    let callerfile;\n    let currentfile;\n\n    Error.prepareStackTrace = function (err, stack) { return stack; };\n\n    currentfile = err.stack.shift().getFileName();\n\n    while (err.stack.length) {\n      callerfile = err.stack.shift().getFileName();\n\n      if(currentfile !== callerfile) return callerfile;\n    }\n  } catch (err) {\n    // do nothing\n  }\n  return undefined;\n}\n\nmodule.exports = (mochaOptions) => {\n  global.__tps = [Promise.resolve(0)];\n  global.ENV = process.env.NODE_ENV = process.env.NODE_ENV || 'test';\n  global.Mocha = require('mocha');\n  global.chai = require('chai');\n  global.sinon = global.sinon || require('sinon').createSandbox();\n  global.assert = chai.assert;\n  global.expect = chai.expect;\n  global.should = chai.should();\n  global.delay = (time) => {\n    return new Promise(res => {\n      setTimeout(function(){\n        res();\n      }, time);\n    });\n  };\n  global.pdescribe = function(name, fxn) {\n    const testFile = getCaller();\n    if (testFile && mochaOptions && !mochaOptions.parallel) {\n      const newOpts = deepMerge({}, mochaOptions);\n      deepMerge(newOpts, { filters: [testFile], parallel: true, port: 'random' });\n      global.__tps.push(require('./parallel')([newOpts], true));\n    } else {\n      describe(name, fxn);\n    }\n  };\n\n  chai.use(require('chai-as-promised'));\n};\n","var path = require('path');\nvar fs = require('fs');\nvar _0777 = parseInt('0777', 8);\n\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\n\nfunction mkdirP (p, opts, f, made) {\n    if (typeof opts === 'function') {\n        f = opts;\n        opts = {};\n    }\n    else if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777 & (~process.umask());\n    }\n    if (!made) made = null;\n    \n    var cb = f || function () {};\n    p = path.resolve(p);\n    \n    xfs.mkdir(p, mode, function (er) {\n        if (!er) {\n            made = made || p;\n            return cb(null, made);\n        }\n        switch (er.code) {\n            case 'ENOENT':\n                mkdirP(path.dirname(p), opts, function (er, made) {\n                    if (er) cb(er, made);\n                    else mkdirP(p, opts, cb, made);\n                });\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                xfs.stat(p, function (er2, stat) {\n                    // if the stat fails, then that's super weird.\n                    // let the original error be the failure reason.\n                    if (er2 || !stat.isDirectory()) cb(er, made)\n                    else cb(null, made);\n                });\n                break;\n        }\n    });\n}\n\nmkdirP.sync = function sync (p, opts, made) {\n    if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777 & (~process.umask());\n    }\n    if (!made) made = null;\n\n    p = path.resolve(p);\n\n    try {\n        xfs.mkdirSync(p, mode);\n        made = made || p;\n    }\n    catch (err0) {\n        switch (err0.code) {\n            case 'ENOENT' :\n                made = sync(path.dirname(p), opts, made);\n                sync(p, opts, made);\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                var stat;\n                try {\n                    stat = xfs.statSync(p);\n                }\n                catch (err1) {\n                    throw err0;\n                }\n                if (!stat.isDirectory()) throw err0;\n                break;\n        }\n    }\n\n    return made;\n};\n","const mkdirp = require('mkdirp');\nconst path = require('path');\nconst fs = require('fs');\n\nmodule.exports = function writeCoverage(coverage, file) {\n  mkdirp.sync(path.dirname(file), (err) => {\n    if (err) throw err;\n  });\n\n  const contents = JSON.stringify(coverage || {});\n  if (contents !== '{}') {\n    fs.writeFileSync(file, contents, err => {\n      if(err) throw err;\n    });\n  }\n};","const path = require('path');\n\nconst writeCoverage = require('./writecoverage');\nconst puppeteer = require('puppeteer');\n\nasync function writePageCoverage(p, nycReport) {\n  /* istanbul ignore next */\n  const jsCoverage = await p.evaluate(() => window.__coverage__);\n  writeCoverage(jsCoverage, path.join(nycReport, `./${Date.now()}-browser-coverage.json`));\n}\n\nfunction setPageForCoverage(p, nycReport) {\n  p.goto = async (url, options) => {\n    await writePageCoverage(p, nycReport);\n    const ret = p.mainFrame().goto(url, options);\n    return ret;\n  };\n\n  p._close = p.close;\n  p.close = async () => {\n    await writePageCoverage(p, nycReport);\n    return p._close();\n  };\n}\n\nmodule.exports = async function(root, coverage, nycReport = path.join(root, './.nyc_output')) {\n  let browser;\n  if (!global.browser) {\n    browser = global.browser = await puppeteer.launch({\n      // to make it work in circleci\n      args: [\n        '--no-sandbox',\n        '--disable-setuid-sandbox'\n      ],\n      ignoreHTTPSErrors: true,\n      headless: process.env.HEADLESS !== 'false',\n      devtools: false\n    });\n\n    if (coverage) {\n      browser.__newPage = browser.newPage;\n      browser.newPage = async () => {\n        const p = await browser.__newPage();\n        setPageForCoverage(p, nycReport);\n        return p;\n      };\n\n      browser.__close = browser.close;\n      browser.close = async () => {\n        const pages = await browser.pages();\n        for (let i = 0; i < pages.length; i++) {\n          await pages[i].close();\n        }\n        return browser.__close();\n      };\n    }\n  } else {\n    browser = global.browser;\n  }\n  const page = await browser.newPage();\n  await page.setViewport( { width: 1280, height: 800 } );\n\n  if (!global.page) global.page = page;\n\n  return {\n    browser,\n    page\n  };\n};\n","const fs = require('fs');\n\nconst cov = require('istanbul-lib-coverage'),\n  srcmap = require('istanbul-lib-source-maps'),\n  { createInstrumenter } = require('istanbul-lib-instrument'),\n  loadDir = require('../loaddir'),\n  reporter = require('istanbul-api').createReporter();\n\nconst instrumenter = createInstrumenter({\n  esModules: true\n});\n\nmodule.exports = function(nycReport, srcFolder, srcFileRegex, reporters = ['html']) {\n  const sm = srcmap.createSourceMapStore({});\n  let map = cov.createCoverageMap();\n  if (fs.existsSync(nycReport)) {\n    // Browser tests\n    loadDir({\n      dir: nycReport,\n      onFile: (file) => {\n        if (file.match(/browser/)) map.merge(JSON.parse(fs.readFileSync(file)));\n      }\n    });\n\n    map = sm.transformCoverage(map).map;\n\n    // unit tests\n    loadDir({\n      dir: nycReport,\n      onFile: (file) => {\n        if (file.match(/unit/)) map.merge(JSON.parse(fs.readFileSync(file)));\n      }\n    });\n\n    // Add Other files without coverage\n    loadDir({\n      dir: srcFolder,\n      onFile: (file) => {\n        if (file.slice(-3) === '.js' && file.match(srcFileRegex) && !map.data[file]) {\n          const content = fs.readFileSync(file).toString();\n          instrumenter.instrumentSync(content, file);\n          const emptyCov = {};\n          emptyCov[file] = instrumenter.fileCoverage;\n          map.merge(emptyCov);\n        }\n      }\n    });\n\n    // Remove files that we don't need coverage of\n    map.filter((file) => file.match(srcFileRegex));\n\n    reporters.forEach(r => reporter.add(r));\n    reporter.write(map);\n  }\n};\n","const fs = require('fs');\nconst path = require('path');\nconst Mocha = require('mocha');\nconst JsonFn = require('json-fn');\n\nconst exec = require('../exec');\nconst server = require('./server');\nconst deepMerge = require('../deepmerge');\nconst testGlobals = require('./testglobals');\nconst loadDir = require('../loaddir');\nconst writeCoverage = require('./writecoverage');\nconst loadBrowser = require('./loadbrowser');\nconst transformCoverage = require('./transformcoverage');\n\nfunction loadTests(dir, mocha, regex, filters) {\n  loadDir({\n    dir: dir,\n    onFile: (filePath) => {\n      if (filters.map(bf => filePath.indexOf(bf) >= 0).indexOf(true) >= 0) {\n        if (filePath.match(regex)) mocha.addFile(filePath);\n      }\n    }\n  });\n}\n\nasync function runCommands(commands) {\n  if (!commands) return;\n  if (Array.isArray(commands)) {\n    for (let j = 0; j < commands.length; j++) {\n      await exec(commands[j]).catch(global.console.error);\n    }\n  } else {\n    await exec(commands).catch(global.console.error);\n  }\n}\n\nasync function runTests(options = {}) {\n  if (Array.isArray(options)) {\n    for (let i = 0; i < options.length; i++) {\n      await runCommands(options.preCommand);\n      delete options.preCommand;\n    }\n    return require('./parallel')(options);\n  }\n\n  const {\n    root = path.resolve('./'),\n    serverOnly = false,\n    runUnitTests = true,\n    runBrowserTests = true,\n    coverage = false,\n    setGlobals = true,\n    testFileRegex = /\\.test\\.js$/,\n    sourceFileRegex = /\\.js$/,\n    filters = [''],\n    folders = {},\n    preCommand = false,\n    port = 'random',\n    securePort = false,\n    useJunitReporter = false,\n    junitXmlFile = path.join(root, `./test-results/${path.basename(root)}/results.xml`),\n    inspect = false,\n    reporters = ['html'],\n    mochaOptions = {}\n  } = options;\n\n  if (inspect) require('inspector').open(undefined, undefined, true);\n\n  const allFolders = deepMerge({\n    unitTest: path.join(root, './test/unit'),\n    browserTest: path.join(root, './test/browser'),\n    public: path.join(root, './test/public'),\n    static: [],\n    coverage: path.join(root, './.nyc_output'),\n    source: path.join(root, './src')\n  }, folders, true);\n\n  // unit test coverage\n  if (coverage && !global.cov) {\n    const { createInstrumenter } = require('istanbul-lib-instrument');\n    const instrumenter = createInstrumenter();\n    const { hookRequire } = require('istanbul-lib-hook');\n    hookRequire(\n      (filePath) => {\n        return filePath.indexOf(allFolders.source) > -1 && filePath.match(sourceFileRegex) && !filePath.match(testFileRegex);\n      },\n      (code, { filename }) => instrumenter.instrumentSync(code, filename)\n    );\n    global.cov = true;\n  }\n\n  await runCommands(preCommand);\n\n  const servers = await server(allFolders.public, {\n    extraStaticFolders: allFolders.static,\n    setGlobals,\n    coverage,\n    port,\n    securePort\n  });\n\n  if (serverOnly) {\n    servers.listen();\n    return 'server';\n  }\n  if (setGlobals) testGlobals(options);\n\n  if (useJunitReporter) {\n    mochaOptions.reporter = 'mocha-junit-reporter';\n    mochaOptions.reporterOptions = {\n      mochaFile: junitXmlFile\n    };\n  }\n  const mocha = new Mocha(mochaOptions);\n\n  if ((runBrowserTests || !runUnitTests) && fs.existsSync(allFolders.browserTest)) {\n    servers.listen();\n    await loadBrowser(root, coverage, allFolders.coverage);\n    loadTests(allFolders.browserTest, mocha, testFileRegex, filters);\n  }\n\n  if ((runUnitTests || !runBrowserTests) && fs.existsSync(allFolders.unitTest)) {\n    loadTests(allFolders.unitTest, mocha, testFileRegex, filters);\n  }\n\n  return new Promise((res, rej) => {\n    mocha.run(async (failures) => {\n      servers.close();\n\n      // close browser\n      if (global.browser) {\n        await browser.close();\n        delete global.browser;\n        delete global.page;\n      }\n\n      // Get and write code coverage\n      if (coverage) {\n        writeCoverage(global.__coverage__, path.join(allFolders.coverage, `./${Date.now()}-unit-coverage.json`));\n        transformCoverage(allFolders.coverage, allFolders.source, sourceFileRegex, reporters);\n      }\n\n      if (failures) return rej(failures);\n      res(0);\n    });\n  });\n}\n\n\nprocess.on('message', async (options) => {\n  options = JsonFn.parse(options);\n  const before = typeof options.before === 'function' ? options.before() : false;\n  if (before instanceof Promise) await before;\n\n  await runTests(options).catch(f => {\n    if (Number(f)) process.send(`${f}`);\n    else throw f;\n  }).then(r => {\n    if (r !== 'server') process.exit();\n  });\n});\n\nmodule.exports = runTests;\n","module.exports = (obj, keys = []) => {\n  const ret = {};\n  keys.forEach(k => {\n    if (obj[k]) ret[k] = obj[k];\n  });\n  return ret;\n};\n","module.exports = {\n  eslintrc: require('./eslintrc'),\n  loadDir: require('./loaddir'),\n  deepMerge: require('./deepmerge'),\n  getRollupConfig: require('./getrollupconfig'),\n  generateChangelog: require('./generatechangelog'),\n  exec: require('./exec'),\n  checkTag: require('./checktag'),\n  releaseTag: require('./releasetag'),\n  gitAddCommitPush: require('./gitaddcommitpush'),\n  runTests: require('./test/run'),\n  objectSelect: require('./objectselect')\n};\n"],"names":["env","browser","node","es6","mocha","globals","ENV","chai","sinon","assert","expect","should","delay","port","PATH","SPATH","page","extends","parserOptions","sourceType","ecmaVersion","esversion","rules","indent","quotes","avoidEscape","allowTemplateLiterals","semi","plugins","settings","loadDir","dir","onFile","onDir","deep","fs","existsSync","statSync","isDirectory","readdirSync","forEach","file","filePath","path","join","type","value","Array","isArray","deepMerge","target","merger","mergeArray","Object","keys","k","terser","require$$0","moduleConfig","name","inputFile","outputFolder","minify","outputFileName","extraConfig","filename","basename","slice","lastIndexOf","toLowerCase","format","ret","input","output","sourcemap","preferConst","resolve","mainFields","commonjs","postcss","extensions","inject","require$$1","preset","require$$2","filter","html","htmlMinifierOptions","collapseWhitespace","collapseBooleanAttributes","conservativeCollapse","minifyJS","push","babel","exclude","rootMode","cleanup","comments","rtag","folder","releaseCount","changelogFile","outputUnreleased","multiRepo","oldChangelog","first","packageVersion","require","version","transform","cm","cb","match","exec","gitTags","lastIndex","options","pkg","gitRawCommitsOpts","writeFileSync","readFileSync","scope","Promise","res","rej","conventionalChangelog","pipe","createWriteStream","on","appendFileSync","spawn","execa","splitRegex","command","indexOf","process","stdout","write","stdio","c","args","split","x","trim","runner","code","err","stderr","checkTag","prefix","tag","then","catch","releaseTag","exists","preCommand","files","commitMsg","i","length","portfinder","getPortPromise","second","instrumenter","createInstrumenter","App","SSLApp","staticInstrument","app","coverage","get","relative","onAborted","global","console","log","text","writeHeader","end","instrumentSync","JSON","parse","root","extraStaticFolders","setGlobals","securePort","listeners","startServer","hostingPort","listen","bind","socket","normalApp","secureApp","freePorts","getPorts","key_file_name","__dirname","cert_file_name","l","close","fork","promises","failures","opts","before","toString","childRun","argv","e","Number","error","send","JsonFn","stringify","all","getCaller","Error","callerfile","currentfile","prepareStackTrace","stack","shift","getFileName","undefined","mochaOptions","__tps","NODE_ENV","Mocha","createSandbox","time","setTimeout","pdescribe","fxn","testFile","parallel","newOpts","filters","require$$3","describe","use","require$$4","writeCoverage","mkdirp","sync","dirname","contents","writePageCoverage","p","nycReport","jsCoverage","evaluate","window","__coverage__","Date","now","setPageForCoverage","goto","url","mainFrame","_close","puppeteer","launch","ignoreHTTPSErrors","headless","HEADLESS","devtools","__newPage","newPage","__close","pages","setViewport","width","height","reporter","createReporter","esModules","srcFolder","srcFileRegex","reporters","sm","srcmap","createSourceMapStore","map","cov","createCoverageMap","merge","transformCoverage","data","content","emptyCov","fileCoverage","r","add","loadTests","regex","bf","addFile","runCommands","commands","j","runTests","serverOnly","runUnitTests","runBrowserTests","testFileRegex","sourceFileRegex","folders","useJunitReporter","junitXmlFile","inspect","open","allFolders","unitTest","browserTest","public","static","source","hookRequire","servers","server","testGlobals","reporterOptions","mochaFile","loadBrowser","run","f","exit","obj","eslintrc","getRollupConfig","generateChangelog","require$$5","require$$6","require$$7","gitAddCommitPush","require$$8","require$$9","objectSelect","require$$10"],"mappings":"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"}